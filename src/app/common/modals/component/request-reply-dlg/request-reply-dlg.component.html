
<dialog-app *ngIf="(request$ | async)" class="vertical-scroll-content">
	<!-- header -->
  <dialog-header-app class="flexBetween">
		<div class="flex">
			<div class="flex move">
				<icon-app name="arrow-left-thin" (click)="back()"></icon-app>
				<span class="spacer"></span>
				<icon-app name="arrow-right-thin" (click)="next()"></icon-app>
			</div>

			<div class="title">
				<h2>{{ element.name }}</h2>
				<span class="color-primary fs-m">{{ selectedIndex + 1 }} / {{ elements.length }} <ng-container i18n="@@products">products</ng-container></span>
			</div>
		</div>
		<request-status-badge-app
			[status]="element?.reply?.status"
			[isTeam]="false"
			[creationDate]="request.creationDate">
		</request-status-badge-app>
	</dialog-header-app>

	<!-- content -->
  <div class="flex">

    <!-- left -->
    <div class="left">
      <h3 class="ms" i18n="header@@product-images">Product images</h3>
      <carousel-app [hasPreview]="true" [static]="true" [images]="element.images"></carousel-app>
      <span class="spacer mg-ms"></span>
      <h3 class="ms" i18n="header@@product-attachments">Product attachments</h3>
      <file-list-app [hasPlaceholder]="false" [static]="true" [files]="element.attachments"></file-list-app>
    </div>

    <!-- right -->
    <div class="right">

			<div class="info-banner flexCenter" i18n="@@fill-form-below-reply">
				Please fill in the form below to reply to client
			</div>

      <!-- details -->
      <h3 class="ms" i18n="@@product-details">Product details</h3>

      <extended-form-app
        [disabled]="isDisabled()"
        [definitions]="definitions"
				[isFormStyle]="true"
        [colAmount]="2"
				[fields]="fields"
				(update)="save()">
      </extended-form-app>

      <!-- images -->
      <h3 class="ms capitalize" i18n="@@images">images</h3>
      <image-previewer-2-app
        [isDeletable]="true"
        [size]="120"
        [images]="images"
        (delete)="deleteImg($event)"
        (imageClick)="modal.open($event)">
      </image-previewer-2-app>
			<modal-carousel-app
        #modal
        [images]="images">
      </modal-carousel-app>
      <div class="spacer mg-s" *ngIf="images.length > 0"></div>
      <button [disabled]="isDisabled()" class="secondary add-image capitalize" (click)="inpImg.click()" i18n="@@add-image">Add Image</button>
			<input [disabled]="isDisabled()" #inpImg multiple="true" type="file" accept="image/*" (fileSelect)="addImage($event)"/>

      <!-- attachments -->
      <h3 class="ms capitalize" i18n="@@attachments">attachments</h3>
      <file-list-app
        [showConfirmOnDelete]="false"
        [hasPlaceholder]="false"
        [files]="files"
        [linkedItem]="reply"></file-list-app>
      <div class="spacer mg-s" *ngIf="files.length > 0"></div>
      <button [disabled]="isDisabled()" class="secondary add-attachment" (click)="inpFile.click()" i18n="@@add-attachments">Add Attachments</button>
			<input [disabled]="isDisabled()" #inpFile multiple="true" type="file" (fileSelect)="addAttachment($event)"/>

    </div>

  </div>

  <!-- footer -->
  <dialog-footer-app>
    <ng-container *ngIf="!isDisabled(); else replied">
			<button *ngIf="reply.status !== defaultStatus" class="warn save capitalize" (click)="refuse()" i18n="@@refuse">refuse</button>
      <button class="secondary save capitalize" (click)="saveAndClose()" i18n="@@save">save</button>

      <div toolTip [toolTipMessage]="getTooltipMessage()" toolTipPosition="above-right">
        <button *ngIf="reply.status === defaultStatus; else notSubmitted" class="capitalize" [disabled]="true" i18n="@@submitted">submitted</button>
      </div>
      <ng-template #notSubmitted>
        <button [disabled]="hasEmptyField()" (click)="hasNext() ? saveAndNext() : save(true, true)">{{ hasNext() ? 'Submit & next' : 'Submit' }}</button>
      </ng-template>
		</ng-container>
		<ng-template #replied>
			<span class="bold-s" i18n="@@product-already-replied">This product has already been replied</span>
		</ng-template>
  </dialog-footer-app>
</dialog-app>
