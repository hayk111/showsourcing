
<custom-table-app
	class="list"
	[rows]="rows"
	[descriptor]="descriptor"
	[contextualMenu]="contextualMenuTemplate"
	[hasMenu]="hasMenu"
	[selected]="selection"
	[currentSort]="currentSort"
	placeholder="No product"
	[pending]="pending"
	[count]="count"
	[currentPage]="currentPage"
	(next)="next.emit()"
	(previous)="previous.emit()"
	(goToPage)="goToPage.emit($event)"
	(bottomReached)="bottomReached.emit()"
	(sort)="sort.emit($event)"
	(selectOne)="select.emit($event)"
	(unselectOne)="unselect.emit($event)"
	(selectAll)="selectAll.emit($event)"
	(unselectAll)="unselectAll.emit()"
	[pending]="pending"
	i18n-placeholder="@@no-product">
</custom-table-app>

<!-- contextual menu -->
<ng-template #contextualMenu let-row="row">
	<context-menu-item-app
		class="pointer flexCenter"
		(click)="openAddToProjectDialog.emit(row)"
		i18n="button@@add-to-project">
		Add to project
	</context-menu-item-app>
	<context-menu-item-app
		class="pointer flexCenter"
		(click)="openCreateRequestDlg.emit(row)"
		i18n="button@@send-request-supplier">
		Send request to supplier
	</context-menu-item-app>
	<context-menu-item-app
		class="pointer flexCenter"
		(click)="openRequestFeedbackDialog.emit(row)"
		i18n="button@@request-feedback">
		Request feedback
	</context-menu-item-app>
	<context-menu-item-app
		class="pointer flexCenter"
		(click)="openExportDialog.emit(row)"
		i18n="button@@export">
		Export
	</context-menu-item-app>
	<context-menu-item-app
		class="pointer flexCenter"
		(click)="delete.emit(row)"
		i18n="button@@delete">
		Delete
	</context-menu-item-app>
</ng-template>

<!-- product preview -->
<ng-template #main let-row="row">
	<div class="mainCellWrapper ellipsis name-container contain-strict">
		<div class="mainCell ellipsis">
			<img class="mini imgCtnr"
				[src]="row | image: 's' : 'product-list'" />
			<span class="ellipsis">
				<a class="name txt-btn" [routerLink]="['/product', row.id]">
					{{ row.name || '-' }}
				</a>
			</span>
			<button class="small secondary-dark preview" *ngIf="productPreview" (click)="previewClick.emit(row)" i18n="@@preview">Preview</button>
		</div>
	</div>
</ng-template>

<!-- supplier -->
<ng-template #supplier let-row="row">
	<selector-app
		type="supplier"
		[canCreate]="true"
		[width]="370"
		(update)="update.emit({ id: row.id, supplier: $event })">
		<div class="ellipsis pointer txt-btn"> {{ row?.supplier?.name || '-' }}</div>
	</selector-app>
</ng-template>

<!-- category -->
<ng-template #category let-row="row">
	<selector-app
		type="category"
		[canCreate]="true"
		[width]="370"
		(update)="update.emit({ id: row.id, category: $event })">
		<div class="ellipsis pointer txt-btn"> {{ row?.category?.name || '-' }}</div>
	</selector-app>
</ng-template>

<!-- price -->
<ng-template #price let-row="row">
	<editable-text-app
		#editable
		[hasAction]="false"
		(opened)="inp.focus()"
		(closed)="update.emit({ id: row.id, price: inp.price })">
		<editable-label-app>
			<price-app
				[price]="row?.price">
			</price-app>
		</editable-label-app>
		<input-price-app
			#inp
			(keyup.enter)="editable.close()"
			[price]="row?.price">
		</input-price-app>
	</editable-text-app>
</ng-template>

<!-- moq -->
<ng-template #moq let-row="row">
	<editable-text-app
		#editable
		[hasAction]="false"
		(opened)="inp.focus()"
		(closed)="update.emit({ id: row.id, minimumOrderQuantity: inp.value })">
		<editable-label-app>
			<moq-app
				*ngIf="row?.minimumOrderQuantity; else noMoq"
				[amount]="row?.minimumOrderQuantity">
			</moq-app>
			<ng-template #noMoq> <div>-</div> </ng-template>
		</editable-label-app>
		<input #inp inputApp type="number" [value]="row?.minimumOrderQuantity" (keyup.enter)="editable.close()"/>
	</editable-text-app>
</ng-template>

<!-- creation date -->
<ng-template #creationDate let-row="row">
	{{ row?.creationDate | date: 'dd MMMM y' }}
</ng-template>

<!-- created by -->
<ng-template #createdBy let-row="row">
	{{ row?.createdBy | formatUserName }}
</ng-template>

<!-- favorite -->
<ng-template #rating let-row="row">
	<div>
		<rating-heart-app
			[favorite]="row?.favorite"
			(favorited)="favorited.emit(row.id)"
			(unfavorited)="unfavorited.emit(row.id)">
		</rating-heart-app>
	</div>
</ng-template>

<!-- projects -->
<ng-template #projects let-row="row">
	<div class="flexCenter">
		<span *ngFor="let project of row.projects; trackBy: trackByFn">
			{{ project.name || '-' }}
		</span>
	</div>
</ng-template>

<!-- status -->
<ng-template #status let-row="row">
	<status-selector-app [entity]="row" [typeEntity]="prodErm" selectSize="s"></status-selector-app>
</ng-template>


<!-- for some mindblowing reason if this is put last,
	the viewchild for default template is undefined -->
<ng-template #default let-row="row" let-column="column">
	{{ row[column.propName] }}
</ng-template>

<!-- user -->
<ng-template #user let-row="row">
	<div class="flexCenter userP">{{ row?.createdBy | formatUserName }}</div>
	<ng-template>
		<!-- none -->
		<ng-template #none></ng-template>
	</ng-template>
</ng-template>
