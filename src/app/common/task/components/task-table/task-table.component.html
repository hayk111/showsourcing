<table-app
	[rows]="rows"
	[pending]="pending"
	[selected]="selection"
	[contextualMenu]="contextualMenuTemplate"
	[currentSort]="currentSort"
	[isContextMenuHorizontal]="false"
	[count]="count"
	[currentPage]="currentPage"
	[hasHeader]="hasHeader"
	[hasMenu]="hasMenu"
	[hasSelection]="hasSelection"
	[hasPagination]="hasPagination"
	[placeholder]="'placeholder.no-task' | translate"
	(goToPage)="goToPage.emit($event)"
	(selectOne)="select.emit($event)"
	(unselectOne)="unselect.emit($event)"
	(selectAll)="selectAll.emit($event)"
	(unselectAll)="unselectAll.emit($event)"
	(sort)="sort.emit($event)"
	(bottomReached)="bottomReached.emit()">

	<!-- contextual menu -->
	<ng-template #contextualMenuTemplate let-row="row">
		<context-menu-item-app
			class="pointer flexCenter"
			(click)="delete.emit(row)">
			{{'text.delete' | translate}}
		</context-menu-item-app>
	</ng-template>

		<!-- dynamic columns -->
		<ng-template
			*ngFor="let column of columnsConfig; trackBy: trackByFn"
			let-row="row"
			[columnApp]="'title.' + column.translationKey | translate"
			[sortable]="column.sortable !== false"
			[width]="column.width"
			[sortBy]="column.sortProperty">

    <ng-container [ngSwitch]="column.title">

			<!-- task done -->
			<!-- the only way to read 2 options on single switch case -->
			<ng-container *ngSwitchCase="column.title == 'done' || column.title == '' ? column.title : null">
				<icon-app
					class="pointer"
					[ngClass]="row?.done ? 'task-is-done': 'task-not-done'"
					[name]="row?.done ? 'check-circle' : 'check-circle-light'"
					[size]="24"
					(click)="update.emit({ id: row?.id, done: !row.done })">
				</icon-app>
			</ng-container>

			<!--about: task done + name + product -->
			<ng-container *ngSwitchCase="'about'">
				<div class="about flex">
					<icon-app
						class="about flexStart"
						[ngClass]="row?.done ? 'task-is-done': 'task-not-done'"
						[name]="row?.done ? 'check-circle' : 'check-circle-light'"
						[size]="24" >
					</icon-app>
					<div class="about-container flex">
						<span class="ellipsis pointer task-name">{{ row?.name }}</span>
						<span class="ellipsis pointer product-name">{{ row?.product?.name }}</span>
					</div>
				</div>
			</ng-container>

			<!-- reference -->
			<ng-container *ngSwitchCase="'reference'">
				<div class="mainCellWrapper reference-container ellipsis">
					<span class="ellipsis pointer txt-btn" (click)="previewClick.emit(row)">{{ row?.reference }}</span>
				</div>
			</ng-container>

			<!-- name -->
			<ng-container *ngSwitchCase="'name'">
				<div class="mainCellWrapper name-container ellipsis flexColumn">
					<span class="ellipsis pointer txt-btn" (click)="previewClick.emit(row)">{{ row?.name }}</span>
					<span *ngIf="column.doubleLine.property" class="sub-property">
						{{ column.doubleLine.extraInfo && row[column.doubleLine.property] ?
							column.doubleLine.extraInfo + ' ' + row[column.doubleLine.property] :
							row[column.doubleLine.property] ? row[column.doubleLine.property] : ''}}
					</span>
				</div>
			</ng-container>

			<!-- product -->
			<ng-container *ngSwitchCase="'product'">
				<div class="mainCellWrapper product-container ellipsis">
					<span class="ellipsis pointer txt-btn" (click)="openProduct.emit(row?.product?.id)">{{ row?.product?.name }}</span>
				</div>
			</ng-container>

			<!-- supplier -->
			<ng-container *ngSwitchCase="'supplier'">
				<div class="mainCellWrapper supplier-container ellipsis">
					<span class="ellipsis pointer txt-btn" (click)="openSupplier.emit(row?.supplier?.id)">{{ row?.supplier?.name }}</span>
				</div>
			</ng-container>

			<!-- due date -->
			<ng-container *ngSwitchCase="'due date'">
				<div class="mainCellWrapper due-date-container ellipsis">
					<span class="ellipsis">{{ row?.dueDate | date: 'dd MMM y':'':translate.currentLang }}</span>
				</div>
			</ng-container>

			<!-- due date small -->
			<ng-container *ngSwitchCase="'due date small'">
				<div class="mainCellWrapper ellipsis">
					<span class="ellipsis due-date-small">{{ row?.dueDate | date: 'dd MMM' }}</span>
				</div>
			</ng-container>

			<!-- assignee -->
			<ng-container *ngSwitchCase="'assigned to'">
				<div *ngIf="row?.assignee" class="flex assignee-container ellipsis">
					<user-picture-app
						[user]="row?.assignee"
						[image]="row?.assignee?.avatar"
						[background]="false"
						[fontSize]="16">
					</user-picture-app>
					<span class="assignee-name ellipsis">{{ row?.assignee | formatUserName: true }}</span>
				</div>
			</ng-container>

			<!-- status -->
			<ng-container *ngSwitchCase="'status'">
				<div class="status-col flexVAlign">
					<status-selector-app [entity]="row" [typeEntity]="erm.TASK" [canUpdate]="canUpdate" selectSize="s"></status-selector-app>
				</div>
			</ng-container>

		</ng-container>

	</ng-template>

</table-app>
