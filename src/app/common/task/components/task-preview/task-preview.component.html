<preview-app cdk-scrollable *ngIf="task$ | async">
	<!-- Banner -->
	<preview-banner-app (closed)="close.emit()">
		<banner-task-app
			[task]="task"
			(update)="update($event, 'done')">
		</banner-task-app>
	</preview-banner-app>

	<!-- Header -->
	<preview-header-app
		[entity]="task"
		[entityMD]="erm.TASK"
		(update)="update($event, 'name')">

		<!-- Product badge -->
		<preview-badge-app
			[hasOpenAction]="true"
			[badge]="erm.PRODUCT"
			[value]="task?.product?.name"
			(openActionClicked)="openProduct()"
			(update)="update($event, 'product')">
		</preview-badge-app>

		<!-- Supplier badge -->
		<preview-badge-app
			[hasOpenAction]="true"
			[badge]="erm.SUPPLIER"
			[value]="task?.supplier?.name"
			(openActionClicked)="openSupplier()"
			(update)="update($event, 'supplier')">
		</preview-badge-app>
	</preview-header-app>

	<!-- Date & Assignee -->
	<preview-section-app>
		<div class="date-assignee-section flexAround mg-bottom-l">

			<!-- Date -->
			<div class="left">
				<editable-field-app #editable [hasAction]="false" [inlineLabel]="false"
					(opened)="inpDueDate.select()" [canGrow]="true">
					<label-app i18n="@@due-date">Due date</label-app>
					<editable-label-app>
						<ng-container *ngIf="task?.dueDate; else selectDue">{{ (task?.dueDate | date:'dd-MM-yyyy') }}</ng-container>
						<ng-template #selectDue><ng-container i18n="@@select-due-date">
							Select a due date
						</ng-container></ng-template>
					</editable-label-app>
					<form-field-app>
						<input inputApp #inpDueDate autofocus="true" [value]="task?.dueDate ? (task?.dueDate | date:'yyyy-MM-dd') : ''" type="date"
						(keyup.enter)="updateDueDate(false, inpDueDate.value)" (change)="updateDueDate(false, $event.target.value)"/>
					</form-field-app>
				</editable-field-app>
			</div>

			<!-- Assignee -->
			<div class="right">
				<selector-app
					type="user"
					[width]="210"
					[offsetY]="-26"
					(update)="update($event, 'assignee')">
					<editable-field-app
						#editable [hasAction]="false" [inlineLabel]="false" [canGrow]="true" [openOnClick]="false">
						<label-app i18n="@@assigned-to">Assigned to</label-app>
						<editable-label-app class="flex">
							<user-picture-app
								[user]="task?.assignee" [size]="16" [border]="true">
							</user-picture-app>
							{{ task?.assignee?.firstName }} {{ task?.assignee?.lastName ? task?.assignee?.lastName[0] : ''}}
						</editable-label-app>
					</editable-field-app>
				</selector-app>
			</div>
		</div>

		<divider-app></divider-app>

	</preview-section-app>

	<!-- Description -->
	<preview-section-app [title]="'description'" i18n-title="@@description">
		<input-description-app
			[description]="task?.description"
			(update)="update($event, 'description')">
		</input-description-app>
	</preview-section-app>

	<!-- Task details form -->
	<preview-section-app>
		<dynamic-form-app
			[inlineLabel]="true"
			[fields]="taskDescriptor?.descriptor"
			[value]="task"
			[colAmount]="1"
			(update)="updateTask($event)">
		</dynamic-form-app>
	</preview-section-app>

	<!-- Extended Fields -->
	<preview-section-app *ngIf="(fieldDefinitions$ | async)?.length" [title]="'Extended Fields'">
		<extended-form-app
			[inlineLabel]="true"
			[definitions]="fieldDefinitions$ | async"
			[fields]="task?.extendedFields"
			(update)="updateTask({extendedFields: $event})">
		</extended-form-app>
	</preview-section-app>

	<!-- Activity -->
	<preview-section-app *ngIf="task?.comments?.length" [title]="'comments'" i18n-title="@@comments">
		<comment-list-app [comments]="task.comments"></comment-list-app>
	</preview-section-app>

	<preview-comment-app (added)="addComment($event)"></preview-comment-app>
</preview-app>
