
<table-app
	[placeholder]="'placeholder.no-product' | translate"
	[rows]="rows"
	[type]="'PRODUCT' | erm: 'singular'"
	[footerTemplate]="footerTemplate"
	[currentSort]="currentSort"
  [pending]="pending"
  [count]="count"
	[width]="width"
  [currentPage]="currentPage"
	[createEntityBtnName]="createEntityBtnName"
	[selected]="selection"
	[hasMenu]="hasMenu"
  [hasHeader]="hasHeader"
	[hasPagination]="hasPagination"
	[hasSelection]="hasSelection"
	[hasShowItemsPerPage]="hasShowItemsPerPage"
	[hasBorder]="hasBorder"
  [contextualMenu]="contextualMenuTemplate"
  (goToPage)="goToPage.emit($event)"
  (bottomReached)="bottomReached.emit()"
  (sort)="sort.emit($event)"
  (selectOne)="select.emit($event)"
  (unselectOne)="unselect.emit($event)"
  (selectAll)="selectAll.emit($event)"
	(unselectAll)="unselectAll.emit()"
	(createClick)="createClick.emit()"
	(showItemsPerPage)="showItemsPerPage.emit($event)"
	(hovered)="hovered = $event">

  <!-- dynamic columns -->
  <ng-template
    *ngFor="let column of columnsConfig; trackBy: trackByFn"
    let-row="row"
		[columnApp]="column.translationKey ? ('title.' + column.translationKey | translate) : ''"
		[sortable]="column.sortable !== false"
    [width]="column.width"
		[sortBy]="column.sortProperty"
		[grows]="!column.fixedWidth">
    <ng-container [ngSwitch]="column.name">

			<default-columns-app 
				*ngSwitchDefault
				[row]="row" 
				[column]="column" 
				[hovered]="row.id === hovered"
				[type]="'PRODUCT' | erm"
				(update)="update.emit($event)"
				(previewClick)="previewClick.emit($event)"
				(nameClick)="open.emit($event)"
				(logoClick)="previewClick.emit($event)">
			</default-columns-app>

      <!-- category -->
      <ng-container *ngSwitchCase="'category'">
				<editable-container-app
					class="full-width"
					[hasAction]="false"
					[openOnClick]="false"
					(click)="sel.openMenu()">
					<editable-display-app>
						<selector-app
							#sel
							[type]="'CATEGORY' | erm: 'singular'"
							[hasPicker]="canUpdate"
							[canCreate]="true"
							[width]="370"
							(update)="update.emit({ id: row.id, category: $event })">
							<div class="pointer" >
								{{ row?.category?.name || '-' }}
							</div>
						</selector-app>
					</editable-display-app>
				</editable-container-app>
			</ng-container>

      <!-- price -->
      <ng-container *ngSwitchCase="'price'">
				<editable-container-app
					#editable
					class="full-width"
					[hasAction]="false"
					(opened)="inp.focus()"
					(closed)="update.emit({ id: row.id, price: inp.price })">
					<editable-display-app>
						<price-app [price]="row?.price"></price-app>
					</editable-display-app>
					<input-price-app
						#inp
						[price]="row?.price"
						(keyup.enter)="editable.close()">
					</input-price-app>
				</editable-container-app>
      </ng-container>

      <!-- moq -->
      <ng-container *ngSwitchCase="'moq'">
        <editable-container-app
					#editable
					class="full-width"
          [hasAction]="false"
          (opened)="inp.focus()"
          (closed)="update.emit({ id: row.id, minimumOrderQuantity: inp.value })">
          <editable-display-app>
            <moq-app
							*ngIf="row?.minimumOrderQuantity"
							[moq]="row?.minimumOrderQuantity"
							[moqDescription]="row?.moqDescription">
            </moq-app>
						<div *ngIf="!row?.minimumOrderQuantity">-</div>
          </editable-display-app>
					<input #inp inputApp type="number" 
						[value]="row?.minimumOrderQuantity" (keyup.enter)="editable.close()"/>
        </editable-container-app>
      </ng-container>

      <!-- projects -->
      <ng-container *ngSwitchCase="'projects'">
        <div class="flexCenter">
          <span *ngFor="let project of row.projects; trackBy: trackByFn">
            {{ project.name || '-' }}
          </span>
        </div>
      </ng-container>

    </ng-container>
  </ng-template>

</table-app>

<!-- contextual menu -->
<ng-template #contextualMenuTemplate let-row="row">
	<context-menu-item-app
		(click)="update.emit({ id: row.id, favorite: true })"
		translate="button.set-as-favorite">
	</context-menu-item-app>
	<context-menu-item-app
		(click)="openAddToProjectDialog.emit(row)"
		translate="button.add-to-project">
	</context-menu-item-app>
	<context-menu-item-app
		(click)="openAddTaskDialog.emit(row)"
		translate="button.add-task">
	</context-menu-item-app>
	<context-menu-item-app
		(click)="openAddSampleDialog.emit(row)"
		translate="button.add-sample">
	</context-menu-item-app>
	<divider-app></divider-app>
	<context-menu-item-app
		(click)="archive.emit({ id: row.id, archived: true })"
		translate="button.archive">
	</context-menu-item-app>
	<context-menu-item-warn-app
		(click)="delete.emit(row)"
		translate="button.delete">
	</context-menu-item-warn-app>
</ng-template>

