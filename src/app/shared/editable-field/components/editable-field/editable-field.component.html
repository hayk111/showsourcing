<div *ngIf="!editMode">
  <div class="flex editable" [class.flexBetween]="!isRightAligned" [class.rightAligned]="isRightAligned">
    <div class="editButton leftButton" *ngIf="isRightAligned" (click)="openEditMode()">Edit </div>
    <!-- if we get an id as value, we should display the name of the entity -->
    <!-- else we just display said value -->
    <ng-container [ngSwitch]="true">
      <ng-container *ngSwitchCase="['suppliers', 'events', 'categories'].indexOf(type) > -1">
        <span>
          {{ entityName }}
        </span>
      </ng-container>
      <ng-container *ngSwitchCase="type === 'price'">
        <span>
          {{value?.priceCurrency?.symbol}} {{value?.priceAmount}}
        </span>
        <span class="currencyTag">
          {{ value?.priceCurrency?.id }}
        </span>
      </ng-container>
      <ng-container *ngSwitchCase="type === 'teamMembers'">
        <span class="userOpt">
          <user-picture-app [size]="24" [border]="false" [url]="entityUrl"></user-picture-app>
          {{ entityName }}
        </span>
      </ng-container>
      <ng-container *ngSwitchCase="type === 'tags'">
        <span class="tags">
          <span class="tag" *ngFor="let tag of tags">
            {{ tag.name }}
          </span>
        </span>
      </ng-container>
      <ng-container *ngSwitchCase="type === 'currency'">
        <span>
          {{ value?.priceCurrency?.id }}
        </span>
      </ng-container>
      <ng-container *ngSwitchDefault>
        <span class="flex">
          {{ value }}
        </span>
      </ng-container>

    </ng-container>
    <div class="editButton" *ngIf="!isRightAligned" (click)="openEditMode()">Edit </div>
  </div>
</div>


<div class="flexRow" *ngIf="editMode" (clickOutside)="closeEditMode()">
  <!-- Text/Inline/Number editor -->
  <input-app [label]="label" [value]="value" *ngIf="['text', 'number','text-inline'].indexOf(type) > -1" [type]="type" (update)="updateValue($event)"></input-app>
  <input-app [label]="label" [value]="value.priceAmount" *ngIf="type === 'price'" [type]="type" (update)="updateValue($event)"></input-app>

  <!-- Entity selector -->
  <ng-select #entitySelector class="entitySelector" [virtualScroll]="true" [items]="entities | async" bindLabel="name" bindValue="id"
    *ngIf="['suppliers', 'categories','events'].indexOf(type) > -1" (change)="update.emit($event?.id)" [ngModel]="value">
    <ng-template ng-header-tmp>
      <div class="selectCustomInput">
        <input style="width: 100%" type="text" (input)="entitySelector.filter($event.target.value)" />
      </div>
    </ng-template>
  </ng-select>

  <!-- Tags selector -->
  <ng-select #tagsSelector class="entitySelector" [virtualScroll]="true" multiple="true" [items]="entities | async" bindLabel="name"
    bindValue="id" *ngIf="type === 'tags'" (change)="update.emit($event?.id)" [ngModel]="value" [addTag]="addEntityCallback">
    <ng-template ng-header-tmp>
      <div class="selectCustomInput">
        <input style="width: 100%" type="text" (input)="tagsSelector.filter($event.target.value)" />
      </div>
    </ng-template>
  </ng-select>

  <!-- User selector -->
  <ng-select #userSelector class="entitySelector" [virtualScroll]="true" [items]="entities | async" bindLabel="name" bindValue="id"
    *ngIf="type === 'teamMembers'" (change)="update.emit($event?.id)" [ngModel]="value">
    <ng-template ng-header-tmp>
      <div class="selectCustomInput">
        <input style="width: 100%" type="text" (input)="userSelector.filter($event.target.value)" />
      </div>
    </ng-template>
    <ng-template ng-label-tmp let-item="item">
      <span class="userOpt">
        <user-picture-app [size]="24" [border]="false" [url]="item?.preferences?.profilePicture?.urls?.url_60x45"></user-picture-app>
        {{item.name}}
      </span>
    </ng-template>
    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
      <span class="userOpt">
        <user-picture-app [size]="24" [border]="false" [url]="item?.preferences?.profilePicture?.urls?.url_60x45"></user-picture-app>
        {{item.name}}
      </span>
    </ng-template>
  </ng-select>

  <div class="confirmBlock" *ngIf="['suppliers', 'categories','events', 'tags'].indexOf(type) === -1">
    <span class="confirmIcon icon-close" fs-s color-white bg-txt-secondary (click)="closeEditMode()"></span>
    <span class="confirmIcon icon-thumb-up" fs-s color-white bg-primary (click)="update.emit(textValue); closeEditMode()"></span>
  </div>
</div>
