<card-app>
	<div *ngIf="(listSrv.items$ | async)?.length; else empty" class="container">
		<div class="title"> Products
			<button class="secondary" (click)="viewAll()">View All Products</button>
		</div>
		<div class="products-section">
			<ng-container *ngFor="let product of listSrv.items$ | async; index as i; trackBy: trackById">
				<!-- only the last item has a margin bottom, and if its the final row, no margin-bottom -->
				<product-grid-card-app
					*ngIf="i < maxItemsDisplay"
					[ngClass]="{'no-left-margin': i % 3 == 0, 'margin-bottom-card': (i !== maxItemsDisplay - 1) && (i % 3 == 2)}"
					[hasCheckbox]="false"
					[product]="product"
					[selected]="(listSrv.selection$ | async)?.has(product?.id)"
					(favorited)="listSrv.onItemFavorited(product?.id)"
					(unfavorited)="listSrv.onItemUnfavorited(product?.id)"
					(liked)="listSrv.onThumbUp(product)"
					(disliked)="listSrv.onThumbDown(product)"
					(open)="listSrv.goToDetails(product.id)"
					(preview)="listSrv.openPreview(product)"
					(select)="listSrv.selectOne(product, true)"
					(unselect)="listSrv.unselectOne(product, true)"
					(update)="listSrv.update($event)">
				</product-grid-card-app>
			</ng-container>
		</div>
	</div>

	<ng-template #empty>
		<div class="empty flexCenter flexColumn">
			<icon-app name="product" fontSet="svg"></icon-app>
			<h1>Currently this supplier had no products associated</h1>
			<h3 class="xl">You can start adding products now</h3>
			<button (click)="listSrv.create(true, {supplier: {id: supplierId}})">Add Product</button>
		</div>
	</ng-template>

	<selection-bar-app
		[isShown]="(listSrv.selection$ | async).size > 0"
		[selection]="listSrv.selection$ | async"
		(close)="listSrv.unselectAll()">

		<action-bar-app
			[favorite]="listSrv.allSelectedFavorite"
			[multiple]="true"
			(onFavorite)="listSrv.onFavoriteAllSelected()"
			(onUnfavorite)="listSrv.onUnfavoriteAllSelected()"
			(liked)="listSrv.onMultipleThumbUp($event)"
			(disliked)="listSrv.onMultipleThumbDown($event)">

			<button class="icon light" (click)="openAddToProjectDialog()">
				<icon-app class="fs-xl" name="folder-light" fontSet="svg"></icon-app>
			</button>
			<context-menu-app>
				<context-menu-trigger-app>
					<button class="icon light">
						<icon-app name="dots-vertical" size="m"></icon-app>
					</button>
				</context-menu-trigger-app>
				<context-menu-item-app (click)="openExportDialog()">
					Export
				</context-menu-item-app>
				<context-menu-item-app (click)="openRequestFeedbackDialog()">
					Request For Team Feedback
				</context-menu-item-app>
			</context-menu-app>

			<button class="icon light" (click)="listSrv.deleteSelected()">
				<icon-app name="trash-bin"></icon-app>
			</button>
		</action-bar-app>
	</selection-bar-app>
</card-app>

<product-preview-app
	*ngIf="listSrv.previewOpen"
	[product]="listSrv.previewed"
	(close)="listSrv.closePreview()">
</product-preview-app>
