
<ng-container *ngIf="dataSrv.items$ | async as products; else spinner">
	<!-- top panel -->
	<top-panel-app
		title="My Products"
		buttonName="Add {{ viewSrv.entityMetadata.singular }}"
		[subtitles]="['Products', 'all']"
		[center]="false"
		(buttonClick)="commonDlgSrv.openCreateDlg(true)">
	</top-panel-app>

	<sub-panel-app
		[hasSwitch]="true"
		[hasFilter]="true"
		[buttonIcon]="false"
		[filtersAmount]="dataSrv.filterList.asFilters().length"
		(showFilters)="viewSrv.openFilterPanel()"
		(search)="dataSrv.search($event)"
		(viewChange)="onViewChange($event)">

		<!-- <search-autocomplete-app [xPosition]="0" [yPosition]="35" [width]="386">
			<search-autocomplete-item-app *ngFor="let element of (smartSearchFilterElements$ | async); trackBy: trackByFn">
				<search-autocomplete-item-content-app
					[selectable]="true" [title]="element.name" [subtitle]="element.type"
					[checked]="element.checked" [icon]="element.type"
					(check)="dataSrv.addFilter({ type: element.type, value: element.id, entity: element })"
					(uncheck)="dataSrv.removeFilter({ type: element.type, value: element.id, entity: element })">
				</search-autocomplete-item-content-app>
			</search-autocomplete-item-app>
		</search-autocomplete-app> -->

		<product-sorting-menu-app
			[currentSort]="dataSrv.currentSort"
			[gridView]="viewSrv.view === 'card'"
			(sortFromMenu)="dataSrv.sortFromMenu($event)">
		</product-sorting-menu-app>

		<!-- <context-menu-app>
			<context-menu-trigger-app>
				<button class="secondary flex sort-2">
					<p>Product Only</p>
					<div><icon-app name="caret-down" class="color-txt-primary"></icon-app></div>
				</button>
			</context-menu-trigger-app>
		</context-menu-app> -->

	</sub-panel-app>

	<!-- views: either one will be displayed when the correct view is selected -->
	<products-list-view-app
		*ngIf="viewSrv.view === 'list'"
		class="list-view"
		[selection]="selectionSrv.selection$ | async"
		[currentSort]="dataSrv.currentSort"
		[rows]="products"
		[pending]="dataSrv.pending"
		(previewClick)="viewSrv.openPreview($event)"
		(select)="selectionSrv.selectOne($event, true)"
		(unselect)="selectionSrv.unselectOne($event, true)"
		(selectAll)="selectionSrv.selectAll($event, true)"
		(unselectAll)="selectionSrv.unselectAll()"
		(open)="viewSrv.goToDetails($event)"
		(favorited)="dataSrv.onItemFavorited($event)"
		(unfavorited)="dataSrv.onItemUnfavorited($event)"
		(bottomReached)="dataSrv.loadMore()"
		(sort)="dataSrv.sort($event)"
		(openAddToProjectDialog)="commonDlgSrv.openAddToProjectDialog($event)"
		(openExportDialog)="commonDlgSrv.openExportDialog($event)"
		(openRequestFeedbackDialog)="commonDlgSrv.openRequestFeedbackDialog($event)"
		(openRequestQuotationDialog)="commonDlgSrv.openRequestQuotationDialog($event)"
		(delete)="dataSrv.deleteOne($event)">
	</products-list-view-app>

	<products-card-view-app
		class="card-view"
		*ngIf="viewSrv.view === 'card'"
		[currentSort]="dataSrv.currentSort"
		[rows]="products"
		[selection]="selectionSrv.selection$ | async"
		(update)="dataSrv.update($event)"
		(select)="selectionSrv.selectOne($event, true)"
		(unselect)="selectionSrv.unselectOne($event, true)"
		(favorited)="selectionSrv.selectAll($event)"
		(unfavorited)="selectionSrv.unselectAll($event)"
		(liked)="dataSrv.onThumbUp($event)"
		(disliked)="dataSrv.onThumbDown($event)"
		(open)="viewSrv.goToDetails($event)">
	</products-card-view-app>

	<selection-bar-app
		[isShown]="(selectionSrv.selection$ | async).size > 0"
		[selection]="selectionSrv.selection$ | async"
		[hasDelete]="false"
		(close)="selectionSrv.unselectAll()"
		(delete)="dataSrv.deleteSelected()">

		<action-bar-app
			[favorite]="selectionSrv.allSelectedFavorite"
			[multiple]="true"
			(onFavorite)="dataSrv.onFavoriteAllSelected()"
			(onUnfavorite)="dataSrv.onUnfavoriteAllSelected()"
			(liked)="dataSrv.onMultipleThumbUp($event)"
			(disliked)="dataSrv.onMultipleThumbDown($event)">

			<button class="icon light" (click)="commonDlgSrv.openAddToProjectDialog()">
				<icon-app class="fs-xl" name="folder-light" fontSet="svg"></icon-app>
			</button>
			<context-menu-app>
				<context-menu-trigger-app>
					<button class="icon light">
						<icon-app name="dots-vertical" size="m"></icon-app>
					</button>
				</context-menu-trigger-app>
				<context-menu-item-app (click)="commonDlgSrv.openExportDialog()">
					Export
				</context-menu-item-app>
				<context-menu-item-app (click)="commonDlgSrv.openRequestFeedbackDialog()">
					Request For Team Feedback
				</context-menu-item-app>
				<context-menu-item-app (click)="commonDlgSrv.openCompareQuotationDialog()">
					Compare Quotation
				</context-menu-item-app>
			</context-menu-app>

			<button class="icon light" (click)="dataSrv.deleteSelected()">
				<icon-app name="trash-bin"></icon-app>
			</button>
		</action-bar-app>
	</selection-bar-app>

	<filters-app
		[filterList]="dataSrv.filterList"
		[filterTypes]="filterTypes"
		(clickOutside)="viewSrv.closeFilterPanel()"
		*ngIf="viewSrv.filterPanelOpen">
	</filters-app>

	<product-preview-app
		*ngIf="viewSrv.previewOpen"
		[product]="viewSrv.previewed"
		(close)="viewSrv.closePreview()"
		(clickOutside)="viewSrv.closePreview()">
	</product-preview-app>

</ng-container>

<ng-template #spinner>
	<spinner-app></spinner-app>
</ng-template>
