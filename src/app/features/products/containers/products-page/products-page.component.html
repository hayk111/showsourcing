

<ng-container *ngIf="items$ | async as products; else spinner">
	<!-- top panel -->
	<top-panel-app
		[title]="entityMetadata.plural"
		[subtitles]="['Products', 'all']"
		buttonName="Add {{entityMetadata.singular}}"
		(buttonClick)="openCreateDlg(true)">
	</top-panel-app>

	<sub-panel-app
		[hasSwitch]="true"
		[hasFilter]="true"
		[buttonIcon]="false"
		[filtersAmount]="filterList.asFilters().length"
		(showFilters)="openFilterPanel()"
		(search)="search($event)"
		(smartSearch)="smartSearch($event)"
		(viewChange)="onViewChange($event)">

		<search-autocomplete-app [xPosition]="0" [yPosition]="35" [width]="386">
			<search-autocomplete-item-app *ngFor="let element of (smartSearchFilterElements$ | async)">
				<search-autocomplete-item-content-app
					[selectable]="true" [title]="element.name" [subtitle]="element.type"
					[checked]="element.checked" [icon]="element.type"
					(check)="addFilter({ type: element.type, value: element.id, entity: element })"
					(uncheck)="removeFilter({ type: element.type, value: element.id, entity: element })">
				</search-autocomplete-item-content-app>
			</search-autocomplete-item-app>
		</search-autocomplete-app>

		<context-menu-app xPosition="-54" yPosition="36">
			<context-menu-trigger-app>
				<button class="secondary flex sort-1"><!-- style="width: 250px;" -->
						<p *ngIf="currentSort.sortBy === 'name'" class="flex">Sort By Name
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'category.name'" class="flex">Sort By Category
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'supplier.name'" class="flex">Sort By Supplier
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'price.value'" class="flex">Sort By Price
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'minimumOrderQuantity'" class="flex">Sort By MOQ
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'favorite'" class="flex">Sort By Favorite
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<p *ngIf="currentSort.sortBy === 'creationDate'" class="flex">Sort By Created On
							<ng-container *ngTemplateOutlet="direction"></ng-container>
						</p>
						<div><icon-app fontSet="fa" name="caret-down"></icon-app></div>
				</button>
			</context-menu-trigger-app>
			<context-menu-item-app (click)="sortFromMenu('name')" class="menu-item">
				Name
				<ng-container *ngIf="currentSort.sortBy === 'name'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('category.name')" class="menu-item">
				Category
				<ng-container *ngIf="currentSort.sortBy === 'category.name'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('supplier.name')" class="menu-item">
				Supplier
				<ng-container *ngIf="currentSort.sortBy === 'supplier.name'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('price.value')" class="menu-item">
				Price
				<ng-container *ngIf="currentSort.sortBy === 'price.value'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('minimumOrderQuantity')" class="menu-item">
				MOQ
				<ng-container *ngIf="currentSort.sortBy === 'minimumOrderQuantity'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('favorite')" class="menu-item">
				Favorite
				<ng-container *ngIf="currentSort.sortBy === 'favorite'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
			<context-menu-item-app (click)="sortFromMenu('creationDate')" class="menu-item">
				Created On
				<ng-container *ngIf="currentSort.sortBy === 'creationDate'">
					<ng-container *ngTemplateOutlet="direction"></ng-container>
				</ng-container>
			</context-menu-item-app>
		</context-menu-app>

		<context-menu-app xPosition="-74" yPosition="36">
			<context-menu-trigger-app>
				<button class="secondary flex sort-2">
					<p>Product Only</p>
					<div><icon-app fontSet="fa" name="caret-down"></icon-app></div>
				</button>
			</context-menu-trigger-app>
		</context-menu-app>

	</sub-panel-app>

	<!-- views: either one will be displayed when the correct view is selected -->
	<product-list-view-app
		*ngIf="view === 'list'"
		class="list-view"
		[selection]="selected$ | async"
		[currentSort]="currentSort"
		[rows]="products"
		[pending]="pending"
		(previewClick)="openPreview($event)"
		(select)="onItemSelected($event, true)"
		(unselect)="onItemUnselected($event, true)"
		(selectAll)="selectAll($event, true)"
		(unselectAll)="resetSelection()"
		(open)="goToDetails($event)"
		(favorited)="onItemFavorited($event)"
		(unfavorited)="onItemUnfavorited($event)"
		(bottomReached)="loadMore()"
		(sort)="sort($event)"
		(openAddToProjectDialog)="openAddToProjectDialog($event)"
		(openExportDialog)="openExportDialog($event)"
		(openRequestFeedbackDialog)="openRequestFeedbackDialog($event)"
		(delete)="deleteOne($event)"></product-list-view-app>

	<product-card-view-app
		class="card-view"
		*ngIf="view === 'card'"
		[rows]="products"
		[selection]="selected$ | async"
		(update)="update($event)"
		(select)="onItemSelected($event, true)"
		(unselect)="onItemUnselected($event, true)"
		(favorited)="onItemFavorited($event)"
		(unfavorited)="onItemUnfavorited($event)"
		(open)="goToDetails($event)"></product-card-view-app>

	<selection-bar-app
		*ngIf="(selected$ | async).size > 0"
		[selection]="selected$ | async"
		[hasDelete]="false"
		(close)="resetSelection()"
		(delete)="deleteSelected()">

		<action-bar-app
			[favorite]="allSelectedFavorite"
			[products]="selectedItems$ | async"
			(onFavorite)="onFavoriteAllSelected()"
			(onUnfavorite)="onUnfavoriteAllSelected()"
			(multipleVotes)="multipleVotes($event)">

			<button class="icon light" (click)="openAddToProjectDialog()">
				<icon-app fontSet="svg" name="folder" size="m" ></icon-app>
			</button>
			<context-menu-app xPosition="-171" yPosition="-101">
				<context-menu-trigger-app>
					<button class="icon light">
						<icon-app fontSet="svg" name="3-dots-vertical" size="m"></icon-app>
					</button>
				</context-menu-trigger-app>
				<context-menu-item-app (click)="openExportDialog()">
					Export
				</context-menu-item-app>
				<context-menu-item-app (click)="openRequestFeedbackDialog()">
					Request For Team Feedback
				</context-menu-item-app>
			</context-menu-app>

			<button class="icon light" (click)="deleteSelected()">
				<icon-app fontSet="svg" name="trash-bin" size="m"></icon-app>
			</button>
		</action-bar-app>
	</selection-bar-app>

	<filters-app
		(clickOutside)="closeFilterPanel()"
		[filterList]="filterList"
		[byType]="filterList.asByType()"
		*ngIf="filterPanelOpen">
	</filters-app>

	<product-preview-app
		*ngIf="previewOpen"
		[product]="previewed"
		(close)="closePreview()"
		(clickOutside)="closePreview()">

	</product-preview-app>

</ng-container>

<ng-template #spinner>
	<spinner-app></spinner-app>
</ng-template>

<ng-template #direction>
	<ng-container>
		<icon-app class="sortIcon fs-xs"  fontSet="fa" name="angle-down"
			*ngIf="currentSort?.descending; else upArrow;"></icon-app>
		<ng-template #upArrow>
			<icon-app  class="sortIcon fs-xs" fontSet="fa" name="angle-up"></icon-app>
		</ng-template>
	</ng-container>
</ng-template>
