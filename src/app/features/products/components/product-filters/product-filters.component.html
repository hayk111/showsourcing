<!-- filter-panel  is just a wrapper which has as sole function to display the filter panel somewhere on the screen -->
<filter-panel-app *ngIf="filterMap$ | async as filterMap">
	<!-- filter btn panel is a wrapper that displays a clear and close button at the top -->
	<!-- inside it we put the filter btn that are gonna be displayed -->
	<filter-btns-panel-app *ngIf="btnPanelShown" (reset)="onClear()">

		<!-- (suppliers, events, etc) same display for basic entities  -->
		<ng-container *ngFor="let repr of basicRepr">


			<div class="editTitle flexBetween">
				<label>
					{{ repr.pluralName }}
				</label>

				<div *ngIf="getFilterMap(repr.entityName).size > 0">
					<span class="edit pointer" (click)="toggleEntityPanel(repr)">Edit</span>
					<span class="clear pointer" (click)="onClearType(repr.entityName)">Clear</span>
				</div>
			</div>


			<filter-btn-app (click)="toggleEntityPanel(repr)" *ngIf="getFilterMap(repr.entityName).size === 0">
				Filter {{ repr.pluralName }}
			</filter-btn-app>

			<div class="flexColumn">
				<checkbox-app
					*ngFor="let filter of getFilterMap(repr.entityName).values()"
					[checked]="true"
					(uncheck)="onFilterRemoved(filter)">
					{{ filter.value | entityName:repr.entityName | async }}
				</checkbox-app>
			</div>
		</ng-container>

		<!-- (user) filter-tags have a little picture inside them -->
		<div class="editTitle flexBetween">
			<label>
				User
			</label>

			<div *ngIf="getFilterMap(teamMemberRepr.entityName).size > 0">
				<span class="edit pointer" (click)="toggleEntityPanel(teamMemberRepr)">Edit</span>
				<span class="clear pointer" (click)="onClearType(teamMemberRepr.entityName)">Clear</span>
			</div>
		</div>

		<filter-btn-app (click)="toggleEntityPanel(teamMemberRepr)" *ngIf="getFilterMap(teamMemberRepr.entityName).size === 0">
			Filter users
		</filter-btn-app>

		<div class="flexWrap">
			<filter-tag-app
					(filterRemoved)="onFilterRemoved(filter)"
					*ngFor="let filter of getFilterMap(teamMemberRepr.entityName).values()">
				<ng-container *ngIf="filter.value | entity: teamMemberRepr.entityName | async as user">
					<user-picture-app class="" size="16" [url]="user?.preferences?.profilePicture?.urls?.url_60x45"></user-picture-app>
					{{ user.name }}
				</ng-container>

			</filter-tag-app>
		</div>

		<!-- status -->

		<div class="editTitle flexBetween">
			<label>
				Status
			</label>

			<div *ngIf="getFilterMap(statusRepr.entityName).size > 0">
				<span class="edit pointer" (click)="toggleEntityPanel(statusRepr)">Edit</span>
				<span class="clear pointer" (click)="onClearType(statusRepr.entityName)">Clear</span>
			</div>
		</div>

		<filter-btn-app (click)="toggleEntityPanel(statusRepr)" *ngIf="getFilterMap(statusRepr.entityName).size === 0">
			Filter Status
		</filter-btn-app>

		<div class="flexColumn">
			<checkbox-app
				*ngFor="let filter of getFilterMap(statusRepr.entityName).values()"
				[checked]="true"
				(uncheck)="onFilterRemoved(filter)">
				<!-- we display the correct badge color -->
				<div class="flex">
					<badge-app [color]="filter.value"></badge-app>
					<span>{{ filter.value | entityName:statusRepr.entityName | async }}</span>
				</div>

			</checkbox-app>
		</div>

		<!-- favorite -->
		<div class="editTitle">
			<label>
				Favorite
			</label>
		</div>

		<checkbox-app [checked]="getFilterMap('rating').size > 0"  (check)="addFavoriteFilter()" (uncheck)="removeFavoriteFilter()">
			<div class="flex">
				<rating-heart-app [static]="true" [rating]="5"></rating-heart-app>
				Only Show Favorite
			</div>

		</checkbox-app>



		<!-- archived -->
		<div class="editTitle">
			<label>
				Archived
			</label>
		</div>

		<checkbox-app [checked]="getFilterMap('archived').size > 0" (check)="addArchivedFilter()" (uncheck)="removeArchivedFilter()">
			Show Archived Product
		</checkbox-app>

	</filter-btns-panel-app>


	<!-- filter selection panel displays a close / done button at the top -->
	<filter-selection-panel-app *ngIf="!btnPanelShown" (close)="toggleEntityPanel()">
		<filter-entity-panel-app
			[title]="entitySelected.pluralName"
			[type]="entitySelected.entityName"
			*ngIf="entityPanelShown"
			[choices]="choices$ | async"
			[relevantChoices]="relevantChoices$ | async"
			[selected]="getFilterMap(entitySelected)"
			(filterAdded)="onFilterAdded($event)"
			(filterRemoved)="onFilterRemoved($event)">
		</filter-entity-panel-app>
		<filter-price-panel-app *ngIf="pricePanelShown"></filter-price-panel-app>
		<filter-rating-panel-app *ngIf="ratingPanelShown"></filter-rating-panel-app>
	</filter-selection-panel-app>


</filter-panel-app>