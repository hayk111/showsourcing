<sub-panel-app
  [hasSwitch]="false"
  [hasFilter]="false"
  [buttonIcon]="false"
  (search)="search($event)">
</sub-panel-app>

<div class="kanbanCtnr">
  <workflow-kanban2-app
    [columns]="columns$ | async"
    [contextualMenu]="contextualMenu"
    [card]="card"
    [getCurrentColumnFct]="getCurrentColumnFct"
    [selectedItems]="selectionSrv.selection$ | async"
    (itemDropped)="onUpdateProductStatus($event)"
    (selectItem)="selectionSrv.selectOne($event, true)"
    (unselectItem)="selectionSrv.unselectOne($event, true)"
    (selectAllItems)="selectionSrv.selectAll($event, true)"
    (unselectAllItems)="selectionSrv.unselectAll()"
    (previewClick)="viewSrv.openPreview($event)">
  </workflow-kanban2-app>
</div>

<ng-template #card let-row="row" let-column="column" let-dragInProgress="dragInProgress" let-checked="checked" let-selectItem="selectItem" let-unselectItem="unselectItem" let-previewClick="previewClick" let-dragDropEnable$="dragDropEnable$">
	<product-card-app class="marginSmall"
    [product]="row"
    [dragInProgress]="dragInProgress"
    [checked]="checked"
    [enablePreviewLink]="true"
    (dragDropEnable)="dragDropEnable$.next($event)"
    (select)="selectionSrv.selectOne(row, true)"
    (unselect)="selectionSrv.unselectOne(row, true)"
    (clickImage)="viewSrv.openPreview(row)">
  </product-card-app>
</ng-template>

<ng-template #contextualMenu let-row="row">
  <context-menu-app>
    <context-menu-trigger-app>
      <button class="icon light">
        <icon-app name="dots-vertical" size="m"></icon-app>
      </button>
    </context-menu-trigger-app>
    <context-menu-item-app (click)="openAddToProjectDialog(row)">
      <div class="border">Add to project</div>
    </context-menu-item-app>
    <context-menu-item-app (click)="openRequestForQuotationDialog(row)">
      <div class="border">Request for quotation</div>
    </context-menu-item-app>
    <context-menu-item-app (click)="openRequestFeedbackDialog(row)">
      <div class="border">Request feedback</div>
    </context-menu-item-app>
    <context-menu-item-app (click)="openExportDialog(row)">
      <div class="border">Export</div>
    </context-menu-item-app>
    <context-menu-item-app (click)="dataSrv.deleteOne(row)">
      <div class="border">Delete</div>
    </context-menu-item-app>
  </context-menu-app>
</ng-template>

<selection-bar-app
  [isShown]="(selectionSrv.selection$ | async).size > 0"
	[selection]="selectionSrv.selection$ | async"
  [hasDelete]="false"
  (close)="selectionSrv.unselectAll()"
  (delete)="dataSrv.deleteSelected()">

  <action-bar-app
    [favorite]="selectionSrv.allSelectedFavorite"
		[multiple]="true"
		(onFavorite)="dataSrv.onFavoriteAllSelected()"
		(onUnfavorite)="dataSrv.onUnfavoriteAllSelected()"
		(liked)="dataSrv.onMultipleThumbUp($event)"
		(disliked)="dataSrv.onMultipleThumbDown($event)">

    <button class="icon light" (click)="openAddToProjectDialog(null)">
      <icon-app name="folder-light" fontSet="svg"></icon-app>
    </button>
    <button class="icon light" (click)="dataSrv.deleteSelected()">
      <icon-app name="trash-bin"></icon-app>
    </button>
  </action-bar-app>
</selection-bar-app>

<product-preview-app
  *ngIf="viewSrv.previewOpen"
  [product]="viewSrv.previewed"
  (close)="viewSrv.closePreview()"
	(clickOutside)="viewSrv.closePreview()">
</product-preview-app>
