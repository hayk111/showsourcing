<controller-list-app
  [hasSwitch]="false"
  [hasFilter]="true"
  [entityType]="'PRODUCT'"
  [filtersAmount]="filterSrv.filterList.asFilters().length"
  (showFilters)="viewSrv.openFilterPanel()"
  [searchValue]="filterSrv.searchValue"
  (search)="listSrv.search($event)">
</controller-list-app>

<kanban-app
  [cols]="columns$ | async"
  [cardTemplate]="card"
  [selection]="selectionSrv.selection$ | async"
  [amountLoaded]="amountLoaded"
  (drop)="onUpdateProductStatus($event)"
  (multipleDrop)="updateProductsStatus($event)"
  (selectColumn)="onColumnSelected($event)"
  (unselectColumn)="onColumnUnselected($event)"
  (loadMore)="loadMore($event)">
</kanban-app>

<ng-template #card
  let-data="data"
  let-column="column"
  let-dragInProgress="dragInProgress"
  let-checked="checked"
  let-selectItem="selectItem"
  let-unselectItem="unselectItem"
  let-previewClick="previewClick">
	<product-card-app
    [product]="data"
		[enablePreviewLink]="true"
		[highlightOnChecked]="true"
    [checked]="(selectionSrv.selection$ | async).has(data.id)"
    (clickImage)="viewSrv.openPreview(data)"
    (select)="selectionSrv.selectOne($event, true)"
    (unselect)="selectionSrv.unselectOne($event, true)">
  </product-card-app>
</ng-template>

<ng-template #contextualMenu let-row="row">
  <context-menu-app>
    <context-menu-trigger-app>
      <button class="icon light">
        <icon-app name="dots-vertical" size="m"></icon-app>
      </button>
    </context-menu-trigger-app>
    <context-menu-item-app
      (click)="commonModalSrv.openAddToProjectDialog([row])">
      <div class="border" translate="button.add-to-project"></div>
    </context-menu-item-app>
    <context-menu-item-app (click)="commonModalSrv.openRequestFeedbackDialog([row])">
      <div class="border" translate="button.request-feedback"></div>
    </context-menu-item-app>
    <context-menu-item-app (click)="commonModalSrv.openExportDialog([row])">
      <div class="border" translate="button.export"></div>
    </context-menu-item-app>
    <context-menu-item-warn-app (click)="listSrv.deleteOne(row)">
      <div class="border" translate="button.delete"></div>
    </context-menu-item-warn-app>
  </context-menu-app>
</ng-template>

<product-selection-bar-app
	[isShown]="(selectionSrv.selection$ | async).size > 0"
	[selection]="selectionSrv.selection$ | async"
	[favorite]="listSrv.allSelectedFavorite"
	(disliked)="onMultipleThumbDown($event)"
	(liked)="onMultipleThumbUp($event)"
	(favorited)="onFavoriteAllSelected()"
	(unfavorited)="onUnfavoriteAllSelected()"
	(addProject)="commonModalSrv.openAddToProjectDialog(selectionSrv.getSelectedValues())"
	(export)="commonModalSrv.openExportDialog(selectionSrv.getSelectedValues())"
	(createRequest)="commonModalSrv.openSupplierRequest(selectionSrv.getSelectedValues())"
	(requestTeamFeedback)="commonModalSrv.openRequestFeedbackDialog(selectionSrv.getSelectedValues())"
	(compareProducts)="commonModalSrv.openCompareProductDialog(selectionSrv.getSelectedValues())"
	(statusUpdated)="onMultipleStatusChange($event)"
	(massEdit)="commonModalSrv.openMassEditDialog(selectionSrv.getSelectedValues(), erm.PRODUCT)"
	(deleted)="deleteSelected()"
	(close)="selectionSrv.unselectAll()">
</product-selection-bar-app>

<filters-app
	*ngIf="viewSrv.filterPanelOpen"
  [filterList]="filterSrv.filterList"
  [filterTypes]="filterTypes"
  (clickOutside)="viewSrv.closeFilterPanel()">
</filters-app>

<product-preview-app
  *ngIf="viewSrv.previewOpen"
  [product]="viewSrv.previewed"
  (close)="viewSrv.closePreview()"
  (updated)="onUpdate($event)"
  (statusUpdated)="previewStatusUpdate($event)">
</product-preview-app>
